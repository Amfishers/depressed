function previewImage(e,i){if(e&&/image\//.test(e.type))if("image/gif"==e.type){var a=new mOxie.FileReader;a.onload=function(){i(a.result),a.destroy(),a=null},a.readAsDataURL(e.getSource())}else{var l=new mOxie.Image;l.onload=function(){l.downsize(300,300);var e="image/jpeg"==l.type?l.getAsDataURL("image/jpeg",80):l.getAsDataURL();i&&i(e),l.destroy(),l=null},l.load(e.getSource())}}var uploader=new plupload.Uploader({browse_button:"browse",url:"upload.html",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[{title:"图片文件",extensions:"jpg,gif,png"}]}});uploader.init(),uploader.bind("FilesAdded",function(e,i){for(var a=0,l=i.length;a<l;a++){var t=i[a].name,n='<li id="file-'+i[a].id+'"><p class="file-name">'+t+'</p><p class="progress"></p></li>';$(n).appendTo("#file-list"),!function(e){previewImage(i[e],function(a){$("#file-"+i[e].id).append('<img src="'+a+'" />')})}(a)}});